import pkgutil
import json
import os
import io
import re
import asyncio
from dataclasses import dataclass
from typing import Tuple, Union, Optional
from math import radians, cos, sin, asin, sqrt, pi
from functools import lru_cache
from datetime import datetime
from pathlib import Path

import numpy as np
from obspy.core.stream import Stream
from obspy.core.trace import Trace
from obspy.core.utcdatetime import UTCDateTime

from shapely.geometry import Polygon, shape


PathType = Union[Path, str]


@dataclass(eq=True, frozen=True)
class Coordinate():
    lat: np.float32
    lon: np.float32

    @property
    def key(self):
        """
        JSON serialisable dict key
        """
        return f"{self.lat},{self.lon}"


class SyncStreamBuffer:
    """
    Small class that puts some gevent *threading* locks around
    appending and retrieving data from an Obspy Stream.

    This is to allow synchronisation between readers (the Detcap
    app) and writers (Seedlink client(s)).
    """

    def __init__(self, stream: Optional[Stream] = None):
        self.stream = Stream() if stream is None else stream
        self.lock = asyncio.Lock()

    async def append(self, data: Union[Stream, Trace]):
        """
        Append data to the Stream

        Parameters
        ----------
        data
            A Stream or Trace object to append
        """
        async with self.lock:
            if isinstance(data, Trace):
                self.stream.append(data)
            else:
                self.stream += data

    async def get(
        self,
        starttime: Union[UTCDateTime, datetime],
        endtime: Union[UTCDateTime, datetime],
        clear: bool = True,
    ) -> Stream:
        """
        Get all data within a time window.

        Parameters
        ----------
        starttime
            Start of the time window.
        endtime
            End of the time window.
        clear
            If True, only data after endtime will be kept in the Stream
            after the operation is performed.

        Returns
        -------
        Stream
            A Stream object containing the selected data.
        """
        if starttime >= endtime:
            raise ValueError("Starttime must be before endtime")

        async with self.lock:
            if isinstance(starttime, datetime):
                starttime = UTCDateTime(starttime)
            if isinstance(endtime, datetime):
                endtime = UTCDateTime(endtime)
            # slice returns a new Stream with references to the original
            # traces, so we perform a copy as the buffer will discard them
            found = self.stream.copy().slice(starttime=starttime, endtime=endtime)
            if clear:
                # copy so the original stream can be garbage collected
                copy = self.stream.copy().slice(starttime=endtime)
                del self.stream
                self.stream = copy
            return found


def _peak_indices(data):
    data = data[np.where(data != 0)]
    crossings = np.where(np.diff(np.sign(data)))[0]
    prev_c = 0
    peak_idxs = []
    for c in crossings:
        c = c + 1
        segment = data[prev_c:c]
        peak_idx = np.argmax(np.abs(segment))
        peak_idx += data[:prev_c].size
        peak_idxs.append(peak_idx)
        prev_c = c
    segment = data[prev_c:]
    peak_idx = np.argmax(np.abs(segment))
    peak_idx += data[:prev_c].size
    peak_idxs.append(peak_idx)
    return peak_idxs


def _amp_for_peaks(data, indices, sample_rate):
    amplitudes = []
    periods = []
    prev_peak = None
    prev_pi = None
    for i in indices:
        peak = np.abs(data[i])
        if prev_peak is not None:
            amplitudes.append((peak + prev_peak) / 2)
            periods.append(((i - prev_pi) / sample_rate) * 2)
        prev_peak = peak
        prev_pi = i
    return amplitudes, periods


def get_peak_amplitudes_period_proportional(data, sample_rate):
    """
    Get peak amplitudes proportional to time,
    i.e. find max(amplitude / period) in a displacement trace
    by finding the peak positions of its derivative.
    """
    derived = []
    for i, d in enumerate(data):
        if i == 0 or i == data.size - 1:
            derived.append(0)
        else:
            derived.append(0.5 * (data[i + 1] - data[i - 1]))
    derived = np.array(derived)
    peak_indices = _peak_indices(derived)
    return _amp_for_peaks(data, peak_indices, sample_rate)


def get_peak_amplitudes(data, sample_rate):
    data = data[np.where(data != 0)]
    peak_indices = _peak_indices(data)
    return _amp_for_peaks(data, peak_indices, sample_rate)


def mla_polygons(bna_file=None):
    if bna_file is not None and os.path.isfile(bna_file):
        with open(bna_file, "r") as f:
            lines = f.readlines()
    else:
        bna_data = pkgutil.get_data("detcap", "data/mla.bna")
        if bna_data is None:
            raise IOError("Failed to load MLa polygon (package_data: 'data/mla.bna')")
        else:
            lines = io.StringIO(bna_data.decode("utf-8")).readlines()

    wc = []
    ec = []
    sc = []
    w_flag = False
    e_flag = False
    s_flag = False
    for l in lines:
        if "West" in l or "East" in l or "South" in l:
            w_flag = "West" in l
            e_flag = "East" in l
            s_flag = "South" in l
            continue

        str_coord = l.strip().split(",")
        coord = float(str_coord[0]), float(str_coord[1])

        if w_flag:
            wc.append(coord)
        elif e_flag:
            ec.append(coord)
        elif s_flag:
            sc.append(coord)

    return Polygon(wc), Polygon(ec), Polygon(sc)


def geojson_to_polygon(geojson_file, has_properties={}):
    """
    Convert a geojson polygon to a shapely polygon.
    """
    with open(geojson_file, "r") as f:
        data = json.load(f)
    for feature in data["features"]:
        if feature["geometry"]["type"] in ("Polygon", "MultiPolygon"):
            if not has_properties:
                return shape(feature["geometry"])
            elif all(
                feature["properties"][key] == value
                for key, value in has_properties.items()
            ):
                return shape(feature["geometry"])


def haversine(point1: Coordinate, point2: Coordinate) -> np.float32:
    """
    Find the distance (degrees) between two points using haversine method.

    Parameters
    ----------
    point1, point2
        Points in (latitude, longitude) format.

    Returns
    -------
    The distance between the two points.
    """
    lat1, lng1, lat2, lng2 = (np.deg2rad(v) for v in (point1.lat, point1.lon, point2.lat, point2.lon)) 

    lat = lat2 - lat1
    lng = lng2 - lng1
    d = np.sin(lat * 0.5) ** 2 + np.cos(lat1) * np.cos(lat2) * np.sin(lng * 0.5) ** 2
    # Multiply h (radians) by EARTH_RADIUS to get km
    h = 2 * np.arcsin(np.sqrt(d))
    dist_degrees = h * 180.0 / pi
    return dist_degrees


def filter_station_names(station_names, regex_file, include=False):
    with open(regex_file, "r") as f:
        regex = f.read().splitlines()
        regex = [r for r in regex if r and not r.startswith("#")]
        matches = [re.search("|".join(regex), s) for s in station_names]
        matched_streams = [m.group(0) for m in matches if m is not None and m.group(0)]
        if include:
            return matched_streams
        else:
            return [s for s in station_names if s not in matched_streams]


@lru_cache
def load_table(name):
    data = pkgutil.get_data("detcap", f"data/{name}.json")
    if data is None:
        raise IOError(f"Failed to load table {name}")
    else:
        return json.load(io.BytesIO(data))


def round_for_table(distance, table="q"):
    if table == "q":
        return str(f"{round(distance):.1f}")
    elif table == "ak135":
        if distance >= 114:
            return str(f"{round(distance):.1f}")
        else:
            return str(round(distance * 2) / 2)


def seiscomp_q(distance: np.float32, depth: float) -> np.float32:
    """
    Interpolation function used by Seiscomp3's bmagnz function
    (seismology/mb.cpp).

    Parameters
    ----------
    distance
        Epicentral distance in degrees.
    depth
        Depth in kilometres.
    """
    if depth < 100:
        k = int(depth / 25.0 + 2)
        s1 = 0.04 * (depth - 0.25 * (k - 2))
    else:
        k = min((int(depth / 50.0) + 4, 17))
        s1 = 0.02 * (depth - 50.0 * (k - 4))

    j = max(min(int(distance), 108), 2)
    s2 = distance - j
    q1 = _qmb[k - 2][j - 2] + s1 * (_qmb[k - 1][j - 2] - _qmb[k - 2][j - 2])
    Q = q1 + s2 * (
        (_qmb[k - 2][j - 1] + s1 * (_qmb[k - 1][j - 1] - _qmb[k - 2][j - 1])) - q1
    )
    return np.float32(Q)


# Seiscomp3 Q factors, credited to Saul & Bormann.
_qmb = [
    [
        0.0,
        0.0,
        0.0,
        5.75,
        5.88,
        5.96,
        6.01,
        6.10,
        6.14,
        6.17,
        6.17,
        6.16,
        6.15,
        6.15,
        6.10,
        6.06,
        6.05,
        6.04,
        6.05,
        6.08,
        6.11,
        6.16,
        6.23,
        6.30,
        6.39,
        6.48,
        6.55,
        6.61,
        6.64,
        6.66,
        6.67,
        6.67,
        6.67,
        6.67,
        6.66,
        6.66,
        6.65,
        6.66,
        6.66,
        6.67,
        6.67,
        6.69,
        6.69,
        6.70,
        6.71,
        6.72,
        6.72,
        6.73,
        6.74,
        6.75,
        6.76,
        6.77,
        6.77,
        6.78,
        6.79,
        6.79,
        6.80,
        6.81,
        6.82,
        6.82,
        6.83,
        6.83,
        6.84,
        6.84,
        6.84,
        6.85,
        6.85,
        6.85,
        6.86,
        6.87,
        6.87,
        6.87,
        6.87,
        6.88,
        6.88,
        6.88,
        6.89,
        6.89,
        6.90,
        6.89,
        6.89,
        6.89,
        6.90,
        6.92,
        6.94,
        6.97,
        7.01,
        7.05,
        7.09,
        7.15,
        7.20,
        7.25,
        7.31,
        7.37,
        7.42,
        7.46,
        7.50,
        7.55,
        7.59,
        7.64,
        7.68,
        7.73,
        7.75,
        7.78,
        7.78,
        7.78,
        7.78,
        7.78,
    ],
    [
        0.0,
        0.0,
        0.0,
        5.77,
        5.85,
        5.92,
        5.99,
        6.09,
        6.16,
        6.21,
        6.23,
        6.22,
        6.20,
        6.19,
        6.15,
        6.12,
        6.10,
        6.11,
        6.12,
        6.14,
        6.17,
        6.21,
        6.26,
        6.33,
        6.41,
        6.50,
        6.57,
        6.63,
        6.65,
        6.68,
        6.69,
        6.69,
        6.69,
        6.69,
        6.69,
        6.69,
        6.69,
        6.69,
        6.68,
        6.68,
        6.68,
        6.68,
        6.69,
        6.70,
        6.71,
        6.72,
        6.74,
        6.74,
        6.74,
        6.75,
        6.75,
        6.76,
        6.77,
        6.77,
        6.78,
        6.78,
        6.78,
        6.78,
        6.79,
        6.79,
        6.80,
        6.81,
        6.81,
        6.81,
        6.82,
        6.82,
        6.83,
        6.83,
        6.83,
        6.83,
        6.83,
        6.83,
        6.83,
        6.84,
        6.84,
        6.84,
        6.85,
        6.85,
        6.85,
        6.86,
        6.86,
        6.86,
        6.86,
        6.88,
        6.90,
        6.94,
        6.98,
        7.02,
        7.06,
        7.12,
        7.16,
        7.21,
        7.26,
        7.31,
        7.36,
        7.41,
        7.45,
        7.50,
        7.54,
        7.58,
        7.62,
        7.65,
        7.67,
        7.68,
        7.68,
        7.68,
        7.68,
        7.68,
    ],
    [
        0.0,
        0.0,
        0.0,
        5.70,
        5.86,
        5.92,
        5.96,
        6.03,
        6.10,
        6.12,
        6.15,
        6.17,
        6.16,
        6.14,
        6.13,
        6.10,
        6.08,
        6.10,
        6.12,
        6.14,
        6.16,
        6.21,
        6.24,
        6.32,
        6.40,
        6.49,
        6.54,
        6.60,
        6.63,
        6.66,
        6.69,
        6.70,
        6.69,
        6.68,
        6.68,
        6.65,
        6.65,
        6.66,
        6.66,
        6.65,
        6.66,
        6.65,
        6.65,
        6.66,
        6.68,
        6.69,
        6.71,
        6.73,
        6.74,
        6.75,
        6.76,
        6.75,
        6.74,
        6.74,
        6.75,
        6.75,
        6.76,
        6.77,
        6.77,
        6.76,
        6.76,
        6.76,
        6.76,
        6.76,
        6.78,
        6.77,
        6.79,
        6.78,
        6.78,
        6.78,
        6.79,
        6.78,
        6.78,
        6.79,
        6.79,
        6.78,
        6.78,
        6.78,
        6.78,
        6.79,
        6.79,
        6.79,
        6.80,
        6.81,
        6.83,
        6.87,
        6.92,
        6.97,
        7.02,
        7.07,
        7.12,
        7.16,
        7.21,
        7.27,
        7.33,
        7.38,
        7.41,
        7.45,
        7.49,
        7.51,
        7.54,
        7.56,
        7.58,
        7.60,
        7.60,
        7.60,
        7.60,
        7.60,
    ],
    [
        0.0,
        0.0,
        0.0,
        5.73,
        5.80,
        5.82,
        5.88,
        6.01,
        6.10,
        6.14,
        6.15,
        6.14,
        6.14,
        6.09,
        6.04,
        6.03,
        6.03,
        6.03,
        6.07,
        6.11,
        6.13,
        6.18,
        6.22,
        6.27,
        6.37,
        6.46,
        6.53,
        6.59,
        6.62,
        6.64,
        6.66,
        6.67,
        6.67,
        6.66,
        6.65,
        6.63,
        6.64,
        6.63,
        6.63,
        6.64,
        6.63,
        6.63,
        6.64,
        6.65,
        6.66,
        6.66,
        6.67,
        6.69,
        6.72,
        6.74,
        6.75,
        6.74,
        6.74,
        6.72,
        6.72,
        6.73,
        6.72,
        6.72,
        6.73,
        6.72,
        6.73,
        6.73,
        6.74,
        6.74,
        6.74,
        6.73,
        6.74,
        6.74,
        6.74,
        6.74,
        6.75,
        6.75,
        6.76,
        6.77,
        6.78,
        6.78,
        6.77,
        6.76,
        6.76,
        6.76,
        6.74,
        6.75,
        6.77,
        6.79,
        6.82,
        6.87,
        6.93,
        6.99,
        7.03,
        7.08,
        7.13,
        7.17,
        7.21,
        7.28,
        7.34,
        7.39,
        7.41,
        7.47,
        7.53,
        7.57,
        7.62,
        7.63,
        7.64,
        7.64,
        7.64,
        7.64,
        7.64,
        7.64,
    ],
    [
        0.0,
        0.0,
        0.0,
        5.67,
        5.73,
        5.73,
        5.83,
        5.96,
        6.02,
        6.10,
        6.20,
        6.18,
        6.15,
        6.10,
        6.05,
        6.03,
        6.01,
        6.03,
        6.05,
        6.09,
        6.10,
        6.14,
        6.19,
        6.25,
        6.33,
        6.43,
        6.50,
        6.56,
        6.59,
        6.61,
        6.61,
        6.61,
        6.60,
        6.59,
        6.57,
        6.57,
        6.57,
        6.57,
        6.56,
        6.59,
        6.58,
        6.59,
        6.59,
        6.60,
        6.59,
        6.60,
        6.60,
        6.60,
        6.61,
        6.63,
        6.65,
        6.66,
        6.67,
        6.67,
        6.67,
        6.67,
        6.68,
        6.68,
        6.68,
        6.66,
        6.66,
        6.66,
        6.66,
        6.66,
        6.66,
        6.66,
        6.65,
        6.65,
        6.66,
        6.66,
        6.68,
        6.68,
        6.69,
        6.69,
        6.69,
        6.70,
        6.70,
        6.70,
        6.71,
        6.71,
        6.71,
        6.72,
        6.73,
        6.75,
        6.77,
        6.82,
        6.86,
        6.92,
        6.98,
        7.03,
        7.07,
        7.12,
        7.17,
        7.22,
        7.27,
        7.32,
        7.34,
        7.38,
        7.42,
        7.47,
        7.51,
        7.54,
        7.54,
        7.56,
        7.56,
        7.56,
        7.56,
        7.56,
    ],
    [
        0.0,
        0.0,
        0.0,
        5.64,
        5.68,
        5.70,
        5.78,
        5.90,
        5.98,
        6.03,
        6.08,
        6.03,
        5.94,
        5.88,
        5.91,
        5.92,
        5.95,
        6.00,
        6.03,
        6.04,
        6.06,
        6.09,
        6.12,
        6.18,
        6.24,
        6.33,
        6.41,
        6.47,
        6.52,
        6.51,
        6.51,
        6.49,
        6.48,
        6.45,
        6.45,
        6.45,
        6.46,
        6.46,
        6.46,
        6.47,
        6.46,
        6.46,
        6.46,
        6.47,
        6.47,
        6.50,
        6.50,
        6.52,
        6.51,
        6.52,
        6.53,
        6.53,
        6.52,
        6.54,
        6.55,
        6.55,
        6.56,
        6.56,
        6.56,
        6.55,
        6.56,
        6.56,
        6.57,
        6.56,
        6.57,
        6.57,
        6.56,
        6.56,
        6.57,
        6.57,
        6.58,
        6.59,
        6.59,
        6.59,
        6.60,
        6.60,
        6.61,
        6.62,
        6.63,
        6.63,
        6.64,
        6.65,
        6.66,
        6.68,
        6.71,
        6.75,
        6.78,
        6.84,
        6.89,
        6.94,
        6.99,
        7.04,
        7.10,
        7.14,
        7.20,
        7.27,
        7.30,
        7.33,
        7.38,
        7.42,
        7.46,
        7.49,
        7.51,
        7.53,
        7.53,
        7.53,
        7.53,
        7.53,
    ],
    [
        0.0,
        0.0,
        0.0,
        5.49,
        5.50,
        5.56,
        5.68,
        5.76,
        5.86,
        5.85,
        5.84,
        5.73,
        5.70,
        5.68,
        5.75,
        5.77,
        5.84,
        5.89,
        5.96,
        5.94,
        5.97,
        6.01,
        6.07,
        6.13,
        6.22,
        6.29,
        6.34,
        6.38,
        6.42,
        6.41,
        6.41,
        6.40,
        6.38,
        6.35,
        6.35,
        6.36,
        6.36,
        6.37,
        6.38,
        6.39,
        6.38,
        6.37,
        6.35,
        6.34,
        6.35,
        6.37,
        6.38,
        6.41,
        6.40,
        6.41,
        6.42,
        6.42,
        6.42,
        6.44,
        6.44,
        6.42,
        6.44,
        6.44,
        6.44,
        6.46,
        6.48,
        6.47,
        6.47,
        6.45,
        6.43,
        6.43,
        6.42,
        6.43,
        6.46,
        6.47,
        6.47,
        6.49,
        6.50,
        6.51,
        6.52,
        6.53,
        6.53,
        6.54,
        6.55,
        6.54,
        6.55,
        6.55,
        6.56,
        6.58,
        6.61,
        6.64,
        6.69,
        6.73,
        6.76,
        6.81,
        6.85,
        6.89,
        6.95,
        7.03,
        7.08,
        7.17,
        7.21,
        7.22,
        7.32,
        7.35,
        7.42,
        7.45,
        7.47,
        7.47,
        7.47,
        7.47,
        7.47,
        7.47,
    ],
    [
        0.0,
        0.0,
        0.0,
        5.49,
        5.49,
        5.57,
        5.73,
        5.82,
        5.90,
        5.85,
        5.76,
        5.66,
        5.66,
        5.64,
        5.73,
        5.76,
        5.87,
        5.88,
        5.95,
        5.94,
        5.98,
        6.02,
        6.09,
        6.15,
        6.22,
        6.26,
        6.30,
        6.35,
        6.38,
        6.38,
        6.37,
        6.35,
        6.31,
        6.28,
        6.28,
        6.29,
        6.28,
        6.30,
        6.30,
        6.28,
        6.28,
        6.28,
        6.28,
        6.30,
        6.32,
        6.32,
        6.33,
        6.34,
        6.31,
        6.33,
        6.33,
        6.35,
        6.34,
        6.38,
        6.37,
        6.38,
        6.39,
        6.38,
        6.38,
        6.40,
        6.43,
        6.43,
        6.46,
        6.43,
        6.41,
        6.39,
        6.39,
        6.39,
        6.41,
        6.44,
        6.44,
        6.45,
        6.46,
        6.47,
        6.47,
        6.50,
        6.51,
        6.53,
        6.54,
        6.56,
        6.56,
        6.56,
        6.57,
        6.59,
        6.60,
        6.63,
        6.68,
        6.73,
        6.75,
        6.80,
        6.84,
        6.89,
        6.95,
        7.03,
        7.09,
        7.17,
        7.24,
        7.27,
        7.31,
        7.35,
        7.42,
        7.43,
        7.44,
        7.47,
        7.47,
        7.47,
        7.47,
        7.47,
    ],
    [
        0.0,
        0.0,
        0.0,
        5.52,
        5.47,
        5.55,
        5.68,
        5.76,
        5.82,
        5.84,
        5.77,
        5.70,
        5.72,
        5.72,
        5.77,
        5.77,
        5.83,
        5.84,
        5.87,
        5.88,
        5.93,
        5.99,
        6.09,
        6.20,
        6.24,
        6.27,
        6.30,
        6.31,
        6.32,
        6.32,
        6.30,
        6.28,
        6.24,
        6.23,
        6.21,
        6.21,
        6.21,
        6.23,
        6.22,
        6.22,
        6.23,
        6.22,
        6.23,
        6.24,
        6.24,
        6.25,
        6.25,
        6.23,
        6.21,
        6.24,
        6.25,
        6.28,
        6.30,
        6.34,
        6.31,
        6.34,
        6.33,
        6.31,
        6.32,
        6.35,
        6.36,
        6.38,
        6.42,
        6.41,
        6.42,
        6.42,
        6.40,
        6.39,
        6.41,
        6.43,
        6.41,
        6.42,
        6.44,
        6.44,
        6.45,
        6.48,
        6.50,
        6.52,
        6.53,
        6.54,
        6.53,
        6.53,
        6.52,
        6.55,
        6.57,
        6.61,
        6.66,
        6.70,
        6.72,
        6.76,
        6.80,
        6.84,
        6.90,
        6.97,
        7.03,
        7.11,
        7.18,
        7.22,
        7.27,
        7.30,
        7.36,
        7.38,
        7.41,
        7.42,
        7.42,
        7.42,
        7.42,
        7.42,
    ],
    [
        0.0,
        0.0,
        0.0,
        5.58,
        5.51,
        5.55,
        5.64,
        5.74,
        5.75,
        5.77,
        5.74,
        5.72,
        5.75,
        5.78,
        5.79,
        5.79,
        5.82,
        5.82,
        5.83,
        5.87,
        5.93,
        5.99,
        6.06,
        6.15,
        6.16,
        6.18,
        6.23,
        6.27,
        6.25,
        6.27,
        6.25,
        6.21,
        6.19,
        6.21,
        6.20,
        6.20,
        6.19,
        6.18,
        6.16,
        6.17,
        6.15,
        6.16,
        6.19,
        6.20,
        6.18,
        6.21,
        6.20,
        6.20,
        6.17,
        6.20,
        6.20,
        6.24,
        6.25,
        6.31,
        6.29,
        6.32,
        6.31,
        6.29,
        6.29,
        6.30,
        6.30,
        6.35,
        6.38,
        6.38,
        6.42,
        6.42,
        6.39,
        6.40,
        6.40,
        6.40,
        6.38,
        6.37,
        6.38,
        6.38,
        6.40,
        6.43,
        6.46,
        6.49,
        6.50,
        6.52,
        6.51,
        6.51,
        6.52,
        6.56,
        6.58,
        6.61,
        6.66,
        6.71,
        6.73,
        6.77,
        6.81,
        6.85,
        6.91,
        6.97,
        7.03,
        7.09,
        7.17,
        7.22,
        7.27,
        7.30,
        7.35,
        7.36,
        7.38,
        7.38,
        7.38,
        7.38,
        7.38,
        7.38,
    ],
    [
        0.0,
        0.0,
        0.0,
        5.44,
        5.44,
        5.46,
        5.51,
        5.61,
        5.61,
        5.71,
        5.72,
        5.74,
        5.76,
        5.79,
        5.78,
        5.78,
        5.78,
        5.80,
        5.81,
        5.86,
        5.88,
        5.99,
        6.05,
        6.15,
        6.15,
        6.16,
        6.18,
        6.21,
        6.18,
        6.19,
        6.19,
        6.17,
        6.14,
        6.17,
        6.15,
        6.14,
        6.14,
        6.14,
        6.12,
        6.14,
        6.13,
        6.13,
        6.16,
        6.18,
        6.15,
        6.16,
        6.16,
        6.17,
        6.14,
        6.18,
        6.18,
        6.21,
        6.22,
        6.28,
        6.27,
        6.28,
        6.28,
        6.26,
        6.27,
        6.26,
        6.27,
        6.30,
        6.32,
        6.32,
        6.38,
        6.38,
        6.36,
        6.38,
        6.38,
        6.37,
        6.36,
        6.37,
        6.37,
        6.39,
        6.40,
        6.42,
        6.44,
        6.46,
        6.46,
        6.47,
        6.48,
        6.49,
        6.49,
        6.53,
        6.57,
        6.62,
        6.66,
        6.71,
        6.74,
        6.77,
        6.81,
        6.86,
        6.92,
        6.99,
        7.06,
        7.12,
        7.20,
        7.24,
        7.29,
        7.32,
        7.36,
        7.37,
        7.41,
        7.39,
        7.39,
        7.39,
        7.39,
        7.39,
    ],
    [
        0.0,
        0.0,
        0.0,
        5.38,
        5.43,
        5.49,
        5.52,
        5.57,
        5.59,
        5.66,
        5.73,
        5.76,
        5.77,
        5.78,
        5.79,
        5.81,
        5.82,
        5.84,
        5.85,
        5.89,
        5.95,
        6.02,
        6.06,
        6.11,
        6.15,
        6.18,
        6.18,
        6.17,
        6.17,
        6.18,
        6.16,
        6.16,
        6.15,
        6.14,
        6.15,
        6.14,
        6.14,
        6.14,
        6.14,
        6.14,
        6.14,
        6.16,
        6.15,
        6.14,
        6.14,
        6.14,
        6.14,
        6.16,
        6.17,
        6.18,
        6.19,
        6.21,
        6.23,
        6.23,
        6.24,
        6.25,
        6.26,
        6.26,
        6.26,
        6.27,
        6.27,
        6.29,
        6.31,
        6.31,
        6.32,
        6.33,
        6.34,
        6.35,
        6.34,
        6.35,
        6.35,
        6.36,
        6.37,
        6.38,
        6.39,
        6.41,
        6.41,
        6.42,
        6.44,
        6.44,
        6.46,
        6.47,
        6.49,
        6.52,
        6.54,
        6.58,
        6.62,
        6.66,
        6.69,
        6.73,
        6.78,
        6.81,
        6.87,
        6.92,
        6.99,
        7.04,
        7.10,
        7.14,
        7.19,
        7.22,
        7.25,
        7.27,
        7.28,
        7.32,
        7.32,
        7.32,
        7.32,
        7.32,
    ],
    [
        0.0,
        0.0,
        0.0,
        5.37,
        5.40,
        5.44,
        5.48,
        5.54,
        5.57,
        5.65,
        5.71,
        5.75,
        5.75,
        5.78,
        5.78,
        5.80,
        5.82,
        5.85,
        5.85,
        5.90,
        5.94,
        6.00,
        6.04,
        6.08,
        6.12,
        6.14,
        6.14,
        6.14,
        6.14,
        6.15,
        6.15,
        6.14,
        6.13,
        6.13,
        6.14,
        6.14,
        6.12,
        6.11,
        6.11,
        6.11,
        6.11,
        6.12,
        6.11,
        6.11,
        6.11,
        6.12,
        6.13,
        6.15,
        6.16,
        6.17,
        6.18,
        6.20,
        6.21,
        6.21,
        6.22,
        6.23,
        6.23,
        6.23,
        6.23,
        6.25,
        6.25,
        6.26,
        6.30,
        6.29,
        6.31,
        6.32,
        6.34,
        6.34,
        6.34,
        6.34,
        6.34,
        6.35,
        6.36,
        6.37,
        6.37,
        6.38,
        6.38,
        6.39,
        6.41,
        6.42,
        6.44,
        6.45,
        6.47,
        6.50,
        6.52,
        6.57,
        6.61,
        6.65,
        6.68,
        6.72,
        6.77,
        6.81,
        6.86,
        6.93,
        6.99,
        7.04,
        7.10,
        7.13,
        7.18,
        7.20,
        7.23,
        7.25,
        7.28,
        7.34,
        7.34,
        7.34,
        7.34,
        7.34,
    ],
    [
        0.0,
        0.0,
        0.0,
        5.42,
        5.44,
        5.48,
        5.50,
        5.55,
        5.57,
        5.63,
        5.66,
        5.70,
        5.72,
        5.75,
        5.78,
        5.80,
        5.84,
        5.88,
        5.91,
        5.95,
        5.98,
        6.05,
        6.10,
        6.13,
        6.15,
        6.16,
        6.15,
        6.14,
        6.12,
        6.13,
        6.12,
        6.12,
        6.11,
        6.11,
        6.11,
        6.10,
        6.10,
        6.10,
        6.10,
        6.10,
        6.09,
        6.10,
        6.09,
        6.09,
        6.10,
        6.11,
        6.13,
        6.15,
        6.17,
        6.19,
        6.20,
        6.22,
        6.22,
        6.21,
        6.21,
        6.21,
        6.22,
        6.21,
        6.21,
        6.23,
        6.23,
        6.25,
        6.28,
        6.28,
        6.29,
        6.30,
        6.31,
        6.30,
        6.30,
        6.31,
        6.30,
        6.31,
        6.32,
        6.33,
        6.34,
        6.35,
        6.37,
        6.38,
        6.40,
        6.41,
        6.43,
        6.45,
        6.47,
        6.50,
        6.53,
        6.57,
        6.61,
        6.65,
        6.68,
        6.73,
        6.77,
        6.81,
        6.86,
        6.92,
        6.96,
        7.01,
        7.07,
        7.11,
        7.15,
        7.18,
        7.20,
        7.23,
        7.25,
        7.29,
        7.29,
        7.29,
        7.29,
        7.29,
    ],
    [
        0.0,
        0.0,
        0.0,
        5.43,
        5.44,
        5.48,
        5.50,
        5.53,
        5.53,
        5.59,
        5.61,
        5.65,
        5.69,
        5.74,
        5.78,
        5.82,
        5.88,
        5.94,
        6.01,
        6.02,
        6.08,
        6.15,
        6.20,
        6.22,
        6.21,
        6.21,
        6.20,
        6.16,
        6.13,
        6.13,
        6.11,
        6.11,
        6.12,
        6.12,
        6.11,
        6.10,
        6.10,
        6.11,
        6.11,
        6.10,
        6.11,
        6.09,
        6.10,
        6.10,
        6.10,
        6.12,
        6.14,
        6.16,
        6.17,
        6.18,
        6.19,
        6.21,
        6.21,
        6.20,
        6.19,
        6.19,
        6.19,
        6.19,
        6.20,
        6.21,
        6.21,
        6.22,
        6.25,
        6.26,
        6.27,
        6.27,
        6.28,
        6.26,
        6.27,
        6.27,
        6.26,
        6.26,
        6.28,
        6.29,
        6.30,
        6.31,
        6.34,
        6.36,
        6.37,
        6.39,
        6.42,
        6.45,
        6.48,
        6.51,
        6.53,
        6.56,
        6.60,
        6.64,
        6.68,
        6.72,
        6.76,
        6.80,
        6.85,
        6.91,
        6.96,
        7.01,
        7.07,
        7.11,
        7.14,
        7.18,
        7.19,
        7.22,
        7.25,
        7.28,
        7.28,
        7.28,
        7.28,
        7.28,
    ],
    [
        0.0,
        0.0,
        0.0,
        5.41,
        5.31,
        5.38,
        5.37,
        5.37,
        5.43,
        5.45,
        5.51,
        5.58,
        5.64,
        5.69,
        5.76,
        5.85,
        5.89,
        5.98,
        6.10,
        6.09,
        6.19,
        6.24,
        6.23,
        6.21,
        6.20,
        6.20,
        6.16,
        6.11,
        6.10,
        6.07,
        6.03,
        6.05,
        6.10,
        6.10,
        6.10,
        6.13,
        6.14,
        6.15,
        6.13,
        6.14,
        6.15,
        6.14,
        6.15,
        6.14,
        6.13,
        6.15,
        6.16,
        6.18,
        6.17,
        6.18,
        6.18,
        6.19,
        6.20,
        6.18,
        6.19,
        6.19,
        6.19,
        6.20,
        6.20,
        6.21,
        6.21,
        6.21,
        6.25,
        6.24,
        6.26,
        6.27,
        6.28,
        6.28,
        6.28,
        6.27,
        6.26,
        6.25,
        6.27,
        6.28,
        6.29,
        6.29,
        6.30,
        6.32,
        6.33,
        6.35,
        6.39,
        6.43,
        6.47,
        6.49,
        6.52,
        6.55,
        6.58,
        6.64,
        6.69,
        6.73,
        6.77,
        6.82,
        6.88,
        6.92,
        6.96,
        7.03,
        7.08,
        7.10,
        7.12,
        7.16,
        7.20,
        7.21,
        7.25,
        7.28,
        7.28,
        7.28,
        7.28,
        7.28,
    ],
    [
        0.0,
        0.0,
        0.0,
        4.89,
        5.10,
        5.29,
        5.29,
        5.27,
        5.27,
        5.44,
        5.64,
        5.67,
        5.67,
        5.79,
        5.79,
        5.89,
        6.17,
        6.05,
        6.14,
        6.16,
        6.13,
        6.16,
        6.11,
        6.08,
        6.09,
        6.07,
        6.04,
        6.00,
        6.03,
        6.01,
        6.03,
        6.05,
        6.05,
        6.08,
        6.12,
        6.15,
        6.17,
        6.21,
        6.23,
        6.21,
        6.22,
        6.19,
        6.17,
        6.17,
        6.16,
        6.16,
        6.12,
        6.10,
        6.09,
        6.10,
        6.12,
        6.11,
        6.10,
        6.11,
        6.11,
        6.11,
        6.09,
        6.10,
        6.19,
        6.20,
        6.21,
        6.20,
        6.23,
        6.20,
        6.21,
        6.19,
        6.23,
        6.22,
        6.22,
        6.20,
        6.20,
        6.23,
        6.24,
        6.27,
        6.28,
        6.33,
        6.35,
        6.39,
        6.42,
        6.47,
        6.53,
        6.54,
        6.58,
        6.58,
        6.60,
        6.62,
        6.64,
        6.69,
        6.70,
        6.75,
        6.74,
        6.76,
        6.83,
        6.88,
        6.96,
        6.96,
        7.00,
        7.03,
        7.07,
        7.13,
        7.18,
        7.18,
        7.21,
        7.24,
        7.24,
        7.24,
        7.24,
        7.24,
    ],
]
